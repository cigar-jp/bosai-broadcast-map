# v0 実装計画

## 概要

防災無線マップのv0実装計画。
**「完成させて一周すること」** を優先し、UI → Build → Deploy → Delivery → Logging → Alert の流れを最短で実現する。

---

## Phase 1: UI基盤（地図表示）

### 1.1 MapLibre GL JS のセットアップ
- [ ] `maplibre-gl` パッケージをインストール
- [ ] 地図コンポーネント (`src/components/Map.tsx`) を作成
- [ ] 須坂市周辺を中心とした初期表示（緯度経度: 36.6507, 138.3073）
- [ ] OpenStreetMap タイルを使用
- [ ] MapLibre 用のスタイル定義（style URL/JSON もしくはラスターソース+レイヤー）を用意
- [ ] OSM クレジット表示（UI上の attribution）を実装し利用規約に準拠

### 1.2 基本レイアウト
- [ ] ヘッダーコンポーネント作成
- [ ] 地図を全画面表示するレイアウト
- [ ] React Router でルーティング設定（`/` → 地図ページ）

---

## Phase 2: データ表示（ピン表示）

### 2.1 スピーカーデータの準備
- [ ] `src/data/speakers.json` を作成（GeoJSON形式）
- [ ] サンプルデータを手入力（須坂市内の防災無線スピーカー位置）
- [ ] データ出典・利用条件の確認（必要なら出典表記）

### 2.2 ピン表示
- [ ] GeoJSONデータを地図上にマーカーとして表示
- [ ] マーカースタイル設定（色・サイズ）

### 2.3 ピン詳細表示
- [ ] マーカークリック時にポップアップ表示
- [ ] ポップアップに名称・住所等を表示

### 2.4 ピン一覧表示
- [ ] サイドパネルまたはリストページでスピーカー一覧を表示
- [ ] 一覧からのクリックで地図上の該当ピンにフォーカス

---

## Phase 3: UIライブラリ導入

### 3.1 Shadcn UI セットアップ
- [ ] shadcn/ui をインストール・初期化
- [ ] 必要なコンポーネントを追加（Button, Card, Dialog等）

### 3.2 UIの整備
- [ ] ヘッダーのデザイン調整
- [ ] ピン一覧のカード表示
- [ ] レスポンシブ対応

---

## Phase 4: Logging（ユーザー行動ログ）

### 4.1 Google Analytics セットアップ
- [ ] GA4 プロパティを作成
- [ ] `gtag.js` または `react-ga4` を導入
- [ ] 環境変数で測定IDを管理（Vite では `VITE_` 接頭辞を使用）
- [ ] プライバシー通知/同意の要否を確認（必要なら同意UIを追加）

### 4.2 イベントログ実装
- [ ] ページビュー送信
- [ ] ピンクリックイベント送信
- [ ] 一覧表示イベント送信

---

## Phase 5: Monitoring（エラー監視）

### 5.1 Sentry セットアップ
- [ ] Sentry プロジェクトを作成
- [ ] `@sentry/react` をインストール
- [ ] 環境変数でDSNを管理

### 5.2 エラー監視の実装
- [ ] グローバルエラーハンドラー設定
- [ ] React Error Boundary 設定

---

## Phase 6: CI/CD・デプロイ

### 6.1 GitHub Actions
- [ ] `.github/workflows/ci.yml` を作成
- [ ] lint / build の自動実行
- [ ] PRマージ時のデプロイトリガー

### 6.2 ホスティング
- [ ] Vercel or Cloudflare Pages にプロジェクト接続
- [ ] 本番環境の環境変数設定（GA_ID, SENTRY_DSN）
- [ ] デプロイ確認

### 6.3 Uptime監視
- [ ] UptimeRobot でURL監視を設定
- [ ] ダウン時のアラート通知設定

---

## Phase 7: Alert（通知）

### 7.1 アラート設計
- [ ] 監視対象のアラート条件を定義（例: Uptime 低下、重大JSエラー）
- [ ] 通知先を決定（メール/Slack など）

### 7.2 アラート設定
- [ ] UptimeRobot などの通知先を有効化
- [ ] テスト通知で到達性を確認

---

## 完了条件

- [ ] 須坂市の地図が表示される
- [ ] 防災無線スピーカーの位置がピン表示される
- [ ] ピンをクリックすると詳細が表示される
- [ ] スピーカー一覧が確認できる
- [ ] Google Analytics でイベントが記録される
- [ ] Sentry でエラーが捕捉される
- [ ] 本番URLでアクセス可能
- [ ] Uptime監視が動作している
- [ ] アラート通知が到達する

---

## 技術的な決定事項

| 項目 | 決定 |
|------|------|
| 地図ライブラリ | MapLibre GL JS |
| タイル | OpenStreetMap |
| データ形式 | GeoJSON（リポジトリ内JSON） |
| UIライブラリ | Shadcn UI |
| ログ | Google Analytics 4 |
| エラー監視 | Sentry |
| ホスティング | Vercel or Cloudflare Pages |
| Uptime監視 | UptimeRobot |
