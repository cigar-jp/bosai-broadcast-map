# v0 実装計画

## 概要

防災無線マップのv0実装計画。
**「完成させて一周すること」** を優先し、UI → Build → Deploy → Delivery → Logging → Alert の流れを最短で実現する。

---

## Phase 1: UI基盤（地図表示） ✅

### 1.1 MapLibre GL JS のセットアップ
- [x] `maplibre-gl` パッケージをインストール
- [x] 地図コンポーネント (`src/components/Map.tsx`) を作成
- [x] 須坂市周辺を中心とした初期表示（緯度経度: 36.6507, 138.3073）
- [x] OpenStreetMap タイルを使用
- [x] MapLibre 用のスタイル定義（style URL/JSON もしくはラスターソース+レイヤー）を用意
- [x] OSM クレジット表示（UI上の attribution）を実装し利用規約に準拠

### 1.2 基本レイアウト
- [x] ヘッダーコンポーネント作成
- [x] 地図を全画面表示するレイアウト
- [x] React Router でルーティング設定（`/` → 地図ページ）

---

## Phase 2: データ表示（ピン表示） ✅

### 2.1 スピーカーデータの準備
- [x] `src/data/speakers.json` を作成（GeoJSON形式）
- [x] サンプルデータを手入力（須坂市内の防災無線スピーカー位置）
- [x] データ出典・利用条件の確認（必要なら出典表記）

### 2.2 ピン表示
- [x] GeoJSONデータを地図上にマーカーとして表示
- [x] マーカースタイル設定（色・サイズ）

### 2.3 ピン詳細表示
- [x] マーカークリック時にポップアップ表示
- [x] ポップアップに名称・住所等を表示

### 2.4 ピン一覧表示
- [x] サイドパネルまたはリストページでスピーカー一覧を表示
- [x] 一覧からのクリックで地図上の該当ピンにフォーカス

---

## Phase 3: UIライブラリ導入 ✅

### 3.1 Shadcn UI セットアップ
- [x] shadcn/ui をインストール・初期化
- [x] 必要なコンポーネントを追加（Button, Card, Dialog等）

### 3.2 UIの整備
- [x] ヘッダーのデザイン調整
- [x] ピン一覧のカード表示
- [x] レスポンシブ対応

---

## Phase 4: Logging（ユーザー行動ログ） 🔧

### 4.1 Google Analytics セットアップ
- [ ] GA4 プロパティを作成 ← **手動設定が必要**
- [x] `gtag.js` または `react-ga4` を導入
- [x] 環境変数で測定IDを管理（Vite では `VITE_` 接頭辞を使用）
- [ ] プライバシー通知/同意の要否を確認（必要なら同意UIを追加）

### 4.2 イベントログ実装
- [x] ページビュー送信
- [x] ピンクリックイベント送信
- [x] 一覧表示イベント送信

---

## Phase 5: Monitoring（エラー監視） 🔧

### 5.1 Sentry セットアップ
- [ ] Sentry プロジェクトを作成 ← **手動設定が必要**
- [x] `@sentry/react` をインストール
- [x] 環境変数でDSNを管理

### 5.2 エラー監視の実装
- [x] グローバルエラーハンドラー設定
- [x] React Error Boundary 設定

---

## Phase 6: CI/CD・デプロイ 🔧

### 6.1 GitHub Actions
- [x] `.github/workflows/ci.yml` を作成
- [x] lint / build の自動実行
- [ ] PRマージ時のデプロイトリガー ← ホスティング設定後

### 6.2 ホスティング
- [ ] Vercel or Cloudflare Pages にプロジェクト接続 ← **手動設定が必要**
- [ ] 本番環境の環境変数設定（GA_ID, SENTRY_DSN）
- [ ] デプロイ確認

### 6.3 Uptime監視
- [ ] UptimeRobot でURL監視を設定 ← **手動設定が必要**
- [ ] ダウン時のアラート通知設定

---

## Phase 7: Alert（通知） ⏳

### 7.1 アラート設計
- [ ] 監視対象のアラート条件を定義（例: Uptime 低下、重大JSエラー） ← **手動設定が必要**
- [ ] 通知先を決定（メール/Slack など）

### 7.2 アラート設定
- [ ] UptimeRobot などの通知先を有効化 ← **手動設定が必要**
- [ ] テスト通知で到達性を確認

---

## 完了条件

- [x] 須坂市の地図が表示される
- [x] 防災無線スピーカーの位置がピン表示される
- [x] ピンをクリックすると詳細が表示される
- [x] スピーカー一覧が確認できる
- [ ] Google Analytics でイベントが記録される ← GA4プロパティ作成後
- [ ] Sentry でエラーが捕捉される ← Sentryプロジェクト作成後
- [ ] 本番URLでアクセス可能 ← デプロイ後
- [ ] Uptime監視が動作している ← UptimeRobot設定後
- [ ] アラート通知が到達する ← アラート設定後

---

## 技術的な決定事項

| 項目 | 決定 |
|------|------|
| 地図ライブラリ | MapLibre GL JS |
| タイル | OpenStreetMap |
| データ形式 | GeoJSON（リポジトリ内JSON） |
| UIライブラリ | Shadcn UI |
| ログ | Google Analytics 4 |
| エラー監視 | Sentry |
| ホスティング | Vercel or Cloudflare Pages |
| Uptime監視 | UptimeRobot |
